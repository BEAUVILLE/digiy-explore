<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>DIGIY EXPLORE ‚Äî Lieux, Activit√©s, Exp√©riences (0% Com)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="description" content="DIGIY EXPLORE ‚Äî D√©couvre les meilleurs lieux, restos, activit√©s et h√©bergements. Contact direct, 0% commission, s√©lection DIGIYLYFE.">
  <meta name="theme-color" content="#0b2a1f"/>

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

  <style>
    :root{
      --bg:#020617;
      --bg-soft:#020818;
      --card:#030712;
      --accent-main:#22c55e; /* Vert Explore */
      --accent-soft:#38bdf8; /* Bleu doux */
      --accent-gold:#facc15; /* Or DIGIY */
      --ink:#f9fafb;
      --muted:#cbd5f5;
      --line:#1f2937;
      --shadow-soft:0 20px 45px rgba(15,23,42,0.9);
    }
    *{box-sizing:border-box;margin:0;padding:0;font-family:-apple-system,BlinkMacSystemFont,"SF Pro Text",system-ui,sans-serif}
    body{
      min-height:100vh;
      background:
        radial-gradient(circle at top,rgba(56,189,248,0.18),transparent 60%),
        radial-gradient(circle at bottom,rgba(34,197,94,0.18),transparent 55%),
        #020617;
      color:var(--ink);
      display:flex;
      justify-content:center;
      padding:10px;
      font-size:16px;
    }
    .app{
      width:100%;
      max-width:1100px;
      min-height:100vh;
      background:linear-gradient(135deg,#020617 0%,#020818 50%,#020617 100%);
      border-radius:24px;
      border:1px solid rgba(148,163,184,0.25);
      box-shadow:var(--shadow-soft);
      padding:16px 16px 22px;
      display:flex;
      flex-direction:column;
      position:relative;
      overflow:hidden;
    }
    .app::before{
      content:"";
      position:absolute; inset:-40%;
      background:
        radial-gradient(circle at 0% 0%,rgba(56,189,248,0.16),transparent 55%),
        radial-gradient(circle at 100% 100%,rgba(34,197,94,0.16),transparent 45%);
      opacity:0.8;
      pointer-events:none;
    }

    header{
      position:relative; z-index:2;
      display:flex; justify-content:space-between; align-items:center; gap:10px;
      margin-bottom:12px;
    }
    .brand{display:flex;align-items:center;gap:10px}
    .brand-logo{
      width:42px;height:42px;border-radius:14px;
      background:radial-gradient(circle at 30% 0%,#22c55e,#16a34a);
      display:flex;align-items:center;justify-content:center;
      font-size:24px;
      box-shadow:0 12px 30px rgba(34,197,94,0.65);
    }
    .brand-text-title{
      font-size:20px;font-weight:900;letter-spacing:0.09em;text-transform:uppercase;color:var(--accent-main);
    }
    .brand-text-sub{font-size:14px;color:var(--muted);font-weight:600}
    .back-link{
      font-size:13px;color:var(--muted);text-decoration:none;
      background:rgba(15,23,42,0.9);
      border-radius:999px;border:1px solid rgba(148,163,184,0.6);
      padding:8px 14px;
      display:inline-flex;align-items:center;gap:6px;
      z-index:2;position:relative;font-weight:700;
    }

    main{position:relative;z-index:2;flex:1;display:flex;flex-direction:column;gap:14px}

    .hero{
      background:radial-gradient(circle at top left,rgba(56,189,248,0.18),rgba(3,7,18,0.96));
      border-radius:22px;border:1px solid rgba(148,163,184,0.6);
      padding:16px;
      box-shadow:0 18px 44px rgba(15,23,42,0.95);
      display:flex;flex-direction:column;gap:8px;
    }
    .hero-title{font-size:26px;font-weight:900;color:var(--accent-main)}
    .hero-title span{color:var(--accent-soft)}
    .hero-sub{
      font-size:16px;color:#e5e7eb;max-width:760px;font-weight:500;line-height:1.6;
    }
    .hero-sub strong{font-weight:800;color:var(--accent-soft)}
    .hero-tags{display:flex;flex-wrap:wrap;gap:7px;margin-top:4px}
    .hero-tag{
      font-size:13px;padding:5px 11px;border-radius:999px;
      border:1px solid rgba(148,163,184,0.7);
      background:rgba(15,23,42,0.95);color:#e5e7eb;font-weight:600;
    }
    .hero-tag strong{color:var(--accent-main);font-weight:800}

    .hero-cta-row{margin-top:10px;display:flex;flex-wrap:wrap;gap:8px}
    .hero-cta-btn{
      border:none;border-radius:999px;padding:10px 16px;font-size:14px;font-weight:900;
      cursor:pointer;display:inline-flex;align-items:center;gap:8px;text-decoration:none;white-space:nowrap;
      background:linear-gradient(135deg,#22c55e,#16a34a);
      color:#022c22;box-shadow:0 7px 18px rgba(34,197,94,0.55);
    }
    .hero-cta-btn:hover{transform:translateY(-1px);box-shadow:0 11px 26px rgba(34,197,94,0.7)}
    .hero-cta-btn-secondary{
      border-radius:999px;padding:10px 16px;font-size:13px;font-weight:700;text-decoration:none;
      display:inline-flex;align-items:center;gap:8px;cursor:pointer;
      background:rgba(15,23,42,0.98);color:#e5e7eb;border:1px solid rgba(148,163,184,0.8);
    }
    .hero-cta-btn-secondary:hover{border-color:var(--accent-soft)}

    /* BAR RECHERCHE + FILTRES (vrais) */
    .controls{
      margin-top:10px;
      display:flex;flex-wrap:wrap;gap:8px;align-items:center;
    }
    .search{
      flex:1; min-width:220px;
      display:flex; gap:8px; align-items:center;
      background:rgba(15,23,42,0.96);
      border:1px solid rgba(148,163,184,0.7);
      border-radius:999px;
      padding:8px 12px;
    }
    .search input{
      width:100%;
      border:none; outline:none;
      background:transparent;
      color:var(--ink);
      font-weight:700;
      font-size:13px;
    }
    .search .k{font-size:12px;color:var(--muted);font-weight:800;letter-spacing:.08em;text-transform:uppercase}

    .chips{
      display:flex; flex-wrap:wrap; gap:8px;
    }
    .chip{
      user-select:none;
      padding:7px 11px;
      border-radius:999px;
      background:rgba(15,23,42,0.96);
      border:1px solid rgba(148,163,184,0.7);
      color:#e5e7eb;
      font-size:13px;
      font-weight:800;
      cursor:pointer;
      display:inline-flex; align-items:center; gap:6px;
    }
    .chip small{opacity:.75;font-weight:800}
    .chip.active{
      border-color:rgba(34,197,94,.85);
      box-shadow:0 0 0 3px rgba(34,197,94,.12);
      color:var(--accent-main);
    }
    .chip:hover{border-color:rgba(56,189,248,.85)}

    .layout{
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap:12px;
      align-items:start;
    }
    @media(max-width:900px){
      .layout{grid-template-columns:1fr}
    }

    .section{
      margin-top:16px;
      background:radial-gradient(circle at top right,rgba(15,23,42,0.12),rgba(3,7,18,0.98));
      border-radius:22px;border:1px solid rgba(148,163,184,0.5);
      padding:14px 14px 16px;
      box-shadow:0 16px 38px rgba(15,23,42,0.8);
    }
    .section-header{
      display:flex;justify-content:space-between;align-items:flex-end;gap:8px;margin-bottom:10px;
    }
    .section-title{font-size:18px;font-weight:800;color:var(--accent-soft)}
    .section-sub{font-size:13px;color:var(--muted);max-width:520px}
    .section-link{font-size:12px;color:var(--accent-soft);text-decoration:none;font-weight:600}

    .grid-3{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:12px}
    .grid-2{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px}
    @media(max-width:900px){.grid-3{grid-template-columns:repeat(2,minmax(0,1fr))}}
    @media(max-width:640px){
      .app{border-radius:0;border:none;box-shadow:none}
      .grid-3,.grid-2{grid-template-columns:1fr}
    }

    .card{
      background:radial-gradient(circle at top,rgba(15,23,42,0.98),#020617);
      border-radius:20px;border:1px solid rgba(148,163,184,0.6);
      padding:10px 10px 12px;
      box-shadow:0 12px 30px rgba(15,23,42,0.9);
      display:flex;flex-direction:column;gap:6px;
      position:relative;overflow:hidden;
    }
    .card::before{
      content:"";
      position:absolute;inset:-40%;
      background:radial-gradient(circle at top,rgba(56,189,248,0.08),transparent 55%);
      opacity:0.8;pointer-events:none;
    }
    .card-top{position:relative;z-index:2;display:flex;justify-content:space-between;align-items:flex-start;gap:6px}
    .card-title{font-size:17px;font-weight:800;color:var(--accent-main)}
    .card-sub{font-size:13px;color:var(--accent-soft);font-weight:600}
    .card-badge{
      font-size:11px;padding:4px 8px;border-radius:999px;
      border:1px solid rgba(56,189,248,0.9);
      background:rgba(15,23,42,0.98);
      color:var(--accent-soft);
      white-space:nowrap;font-weight:700;
    }
    .card-body{position:relative;z-index:2;font-size:14px;color:#e5e7eb;line-height:1.5}
    .card-meta{margin-top:5px;font-size:13px;color:#cbd5f5;display:flex;justify-content:space-between;flex-wrap:wrap;gap:6px}
    .card-meta span{display:inline-flex;align-items:center;gap:4px}

    .card-photo{
      margin-top:4px;border-radius:14px;overflow:hidden;max-height:190px;height:190px;
      border:2px solid rgba(56,189,248,0.9);
    }
    .card-photo img{width:100%;height:100%;object-fit:cover;display:block}

    .card-actions{margin-top:8px;display:flex;gap:8px;flex-wrap:wrap}
    .btn{
      border:none;border-radius:999px;padding:9px 13px;font-size:13px;font-weight:800;
      cursor:pointer;display:inline-flex;align-items:center;gap:6px;text-decoration:none;white-space:nowrap;
      transition:all 0.25s;flex-grow:1;justify-content:center;
    }
    .btn-main{background:linear-gradient(135deg,#22c55e,#16a34a);color:#022c22;box-shadow:0 6px 16px rgba(34,197,94,0.55)}
    .btn-main:hover{transform:translateY(-1px);box-shadow:0 10px 22px rgba(34,197,94,0.7)}
    .btn-outline{background:rgba(15,23,42,0.98);color:#e5e7eb;border:1px solid rgba(148,163,184,0.9)}
    .btn-outline:hover{border-color:var(--accent-soft)}

    /* MAP */
    .map-box{
      background:radial-gradient(circle at top,rgba(56,189,248,0.10),rgba(3,7,18,0.98));
      border-radius:22px;border:1px solid rgba(148,163,184,0.5);
      padding:10px;
      box-shadow:0 16px 38px rgba(15,23,42,0.8);
      position:sticky; top:10px;
    }
    #map{
      height:520px;
      border-radius:16px;
      border:1px solid rgba(148,163,184,0.35);
      overflow:hidden;
    }
    .map-help{
      margin-top:8px;
      font-size:12px;
      color:var(--muted);
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      font-weight:700;
    }
    .pill{
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.55);
      background:rgba(15,23,42,0.92);
      display:inline-flex; align-items:center; gap:6px;
    }

    footer{
      position:relative;z-index:2;margin-top:16px;font-size:12px;color:var(--muted);
      display:flex;flex-direction:column;gap:4px;font-weight:600;line-height:1.4;
    }
    footer span{color:var(--accent-main);font-weight:800}

    /* Leaflet tweaks */
    .leaflet-container{background:#061b14}
    .leaflet-popup-content-wrapper{
      background:rgba(3,7,18,.96);
      color:#e5e7eb;
      border:1px solid rgba(148,163,184,0.35);
      border-radius:14px;
    }
    .leaflet-popup-tip{background:rgba(3,7,18,.96)}
    .popup-title{font-weight:900;color:var(--accent-main);margin-bottom:2px}
    .popup-sub{font-weight:700;color:var(--accent-soft);font-size:12px;margin-bottom:6px}
    .popup-links a{
      display:inline-block;
      margin-right:8px;
      margin-bottom:6px;
      padding:6px 10px;
      border-radius:999px;
      background:rgba(15,23,42,.96);
      border:1px solid rgba(148,163,184,.55);
      color:#e5e7eb;
      text-decoration:none;
      font-size:12px;
      font-weight:800;
    }
    .popup-links a:hover{border-color:rgba(34,197,94,.75)}
  </style>
</head>

<body>
<div class="app">
  <header>
    <div class="brand">
      <div class="brand-logo">üß≠</div>
      <div>
        <div class="brand-text-title">DIGIY EXPLORE</div>
        <div class="brand-text-sub">Lieux, activit√©s, exp√©riences ‚Äî S√©n√©gal</div>
      </div>
    </div>

    <a href="https://beauville.github.io/mon-espace-digiy/" class="back-link">
      <span>‚Üê</span> Retour DIGIY HUB
    </a>
  </header>

  <main>
    <!-- HERO -->
    <section class="hero">
      <div class="hero-title">DIGIY EXPLORE <span>0% Commission</span></div>
      <div class="hero-sub">
        D√©couvre les <strong>meilleurs lieux</strong>, <strong>restaurants</strong>,
        <strong>activit√©s</strong> et <strong>h√©bergements</strong> s√©lectionn√©s par DIGIYLYFE.
        Contact direct : <strong>WhatsApp, Appel, Localisation</strong>.
      </div>

      <div class="hero-tags">
        <div class="hero-tag"><strong>City Guide</strong> ‚Äî Saly ‚Ä¢ Dakar ‚Ä¢ Petite C√¥te</div>
        <div class="hero-tag">Contact direct ‚Ä¢ 0% commission DIGIY</div>
        <div class="hero-tag">Restaurants ‚Ä¢ Activit√©s ‚Ä¢ Excursions ‚Ä¢ H√¥tels</div>
        <div class="hero-tag">S√©lection DIGIY ‚Ä¢ Terrain r√©el</div>
      </div>

      <div class="hero-cta-row">
        <a href="#spots" class="hero-cta-btn">üåç Explorer sur la carte</a>
        <a href="#partenaires" class="hero-cta-btn-secondary">üß∞ R√©f√©rencer mon √©tablissement (PRO)</a>
      </div>

      <!-- CONTROLS (filtres r√©els) -->
      <div class="controls" aria-label="Filtres DIGIY EXPLORE">
        <div class="search">
          <div class="k">Recherche</div>
          <input id="q" type="search" placeholder="Ex: Gor√©e, Saly, Bandia, rooftop‚Ä¶" autocomplete="off">
        </div>

        <div class="chips" id="chipsType">
          <div class="chip active" data-type="all">‚ú® Tous</div>
          <div class="chip" data-type="resto">üç≤ Resto</div>
          <div class="chip" data-type="plage">üèñ Plage</div>
          <div class="chip" data-type="culture">üé≠ Culture</div>
          <div class="chip" data-type="nature">üåø Nature</div>
          <div class="chip" data-type="hebergement">üè† H√©bergement</div>
          <div class="chip" data-type="activite">üèÅ Activit√©</div>
        </div>

        <div class="chips" id="chipsZone">
          <div class="chip active" data-zone="all">üìç S√©n√©gal</div>
          <div class="chip" data-zone="dakar">Dakar</div>
          <div class="chip" data-zone="saly">Saly</div>
          <div class="chip" data-zone="petite-cote">Petite C√¥te</div>
        </div>
      </div>
    </section>

    <!-- MAP + SPOTS -->
    <section class="section" id="spots">
      <div class="section-header">
        <div>
          <div class="section-title">Carte interactive & Spots</div>
          <p class="section-sub">
            Clique un spot : la carte zoom + popup. Clique un marker : infos + WhatsApp / Maps / Appel.
          </p>
        </div>
        <a href="#partenaires" class="section-link">Devenir partenaire ‚Üì</a>
      </div>

      <div class="layout">
        <!-- LIST -->
        <div>
          <div id="spotsGrid" class="grid-3"></div>

          <div id="emptyState" class="card" style="display:none;margin-top:12px">
            <div class="card-top">
              <div>
                <div class="card-title">Aucun r√©sultat</div>
                <div class="card-sub">Change filtre ou essaye une autre recherche</div>
              </div>
              <div class="card-badge">Filtre</div>
            </div>
            <div class="card-body">
              Astuce : tape <b>Saly</b>, <b>Dakar</b>, <b>Gor√©e</b>, <b>Bandia</b>‚Ä¶
            </div>
          </div>
        </div>

        <!-- MAP -->
        <div class="map-box">
          <div id="map"></div>
          <div class="map-help">
            <div class="pill">üõ°Ô∏è Public safe : pas de compte, pas de donn√©es sensibles</div>
            <div class="pill">üí¨ WhatsApp : +221 77 134 28 89</div>
          </div>
        </div>
      </div>
    </section>

    <!-- PARTENAIRES -->
    <section class="section" id="partenaires">
      <div class="section-header">
        <div>
          <div class="section-title">Devenir Partenaire DIGIY EXPLORE</div>
          <p class="section-sub">
            Restaurant, h√¥tel, activit√©, service ou spot unique ? R√©f√©rence ton √©tablissement dans DIGIY EXPLORE.
          </p>
        </div>
        <a href="https://beauville.github.io/inscription-digiy/?module=explore&plan=starter"
           class="section-link" target="_blank" rel="noopener">
          Ouvrir la page d‚Äôinscription DIGIY ‚Üí
        </a>
      </div>

      <div class="grid-2">
        <article class="card">
          <div class="card-top">
            <div>
              <div class="card-title">Formule Partenaire</div>
              <div class="card-sub">Visibilit√© & contact direct</div>
            </div>
            <div class="card-badge">0% commission</div>
          </div>
          <div class="card-body">
            Ton spot appara√Æt sur la carte + la liste, avec :
            <ul style="margin-top:8px;padding-left:18px;color:#e5e7eb;line-height:1.55">
              <li>Photo + description</li>
              <li>Zone / type (resto, activit√©, h√©bergement‚Ä¶)</li>
              <li>Boutons WhatsApp, Appel, Maps</li>
              <li>Lien vers ta fiche DIGIY (LOC, RESTO, etc.)</li>
            </ul>
            <div style="margin-top:10px;color:#cbd5f5;font-weight:800">
              Mod√®le DIGIY : le client te contacte directement.
            </div>
          </div>
          <div class="card-actions">
            <a class="btn btn-main"
               href="https://beauville.github.io/inscription-digiy/?module=explore&plan=starter"
               target="_blank" rel="noopener">
              ‚úçÔ∏è Devenir partenaire
            </a>
          </div>
        </article>

        <article class="card">
          <div class="card-top">
            <div>
              <div class="card-title">Parler √† l‚Äô√©quipe DIGIY</div>
              <div class="card-sub">Accompagnement terrain</div>
            </div>
            <div class="card-badge">WhatsApp direct</div>
          </div>
          <div class="card-body">
            Tu pr√©f√®res √©changer avant de t‚Äôinscrire ? √âcris-nous : activit√© + ville + proposition.
          </div>
          <div class="card-actions">
            <a class="btn btn-main"
               href="https://wa.me/221771342889?text=Bonjour%20DIGIY,%20je%20veux%20r%C3%A9f%C3%A9rencer%20mon%20%C3%A9tablissement%20sur%20DIGIY%20EXPLORE."
               target="_blank" rel="noopener">
              üí¨ WhatsApp DIGIY
            </a>
            <a class="btn btn-outline" href="mailto:contact@digiylyfe.com">
              ‚úâÔ∏è Email
            </a>
          </div>
        </article>
      </div>
    </section>
  </main>

  <footer>
    <div>DIGIY EXPLORE ‚Ä¢ <span>Super App DIGIYLYFE</span> ‚Äî S√©n√©gal ‚Üí Afrique</div>
    <div>City guide terrain ‚Ä¢ Lieux, activit√©s, restos, h√©bergements ‚Ä¢ 0% commission c√¥t√© pro.</div>
    <div style="font-size:11px; color:#a8b1c2;">
      DIGIYLYFE facilite la mise en relation. V√©rifiez toujours les informations, les tarifs,
      les conditions et les avis avant de r√©server ou de payer.
    </div>
  </footer>
</div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
/* ============================
   DIGIY EXPLORE ‚Äî PUBLIC SAFE
   Dataset local (mock propre)
   ============================ */

const DIGIY_WA = "221771342889"; // WhatsApp support DIGIY

// Types: resto | plage | culture | nature | hebergement | activite
// Zones: dakar | saly | petite-cote
const SPOTS = [
  {
    id:"goree",
    name:"√éle de Gor√©e",
    type:"culture",
    zone:"dakar",
    city:"Dakar",
    lat:14.6680, lng:-17.3980,
    badge:"Incontournable",
    desc:"Histoire & ruelles color√©es. Maison des Esclaves, artistes, mer.",
    photo:"https://images.unsplash.com/photo-1509099863731-ef4bff19e808?auto=format&fit=crop&w=900&q=80",
    mapsQuery:"Ile de Goree Senegal",
    phone:"",
    waText:"Bonjour DIGIY, je veux infos pour visiter l'√éle de Gor√©e (DIGIY EXPLORE)."
  },
  {
    id:"bandia",
    name:"R√©serve de Bandia (Safari)",
    type:"nature",
    zone:"petite-cote",
    city:"Bandia",
    lat:14.5650, lng:-17.0740,
    badge:"Excursion",
    desc:"Safari 4x4, faune africaine √† ~1h de Dakar. Famille friendly.",
    photo:"https://images.unsplash.com/photo-1518791841217-8f162f1e1131?auto=format&fit=crop&w=900&q=80",
    mapsQuery:"Reserve de Bandia Senegal",
    phone:"",
    waText:"Bonjour DIGIY, je veux infos et r√©servation pour la R√©serve de Bandia (DIGIY EXPLORE)."
  },
  {
    id:"saly-plage",
    name:"Plage de Saly",
    type:"plage",
    zone:"saly",
    city:"Saly",
    lat:14.4390, lng:-17.0050,
    badge:"Spot baln√©aire",
    desc:"Plage + ambiance vacances. Base parfaite pour Petite C√¥te.",
    photo:"https://images.unsplash.com/photo-1500375592092-40eb2168fd21?auto=format&fit=crop&w=900&q=80",
    mapsQuery:"Saly Senegal plage",
    phone:"",
    waText:"Bonjour DIGIY, je veux un bon spot plage √† Saly (DIGIY EXPLORE)."
  },
  {
    id:"quad",
    name:"Sortie Quad Dunes & Plages",
    type:"activite",
    zone:"petite-cote",
    city:"Petite C√¥te",
    lat:14.4100, lng:-16.9800,
    badge:"Sport",
    desc:"Balade quad : dunes, pistes, bords de mer. Briefing s√©curit√© inclus.",
    photo:"https://images.unsplash.com/photo-1601758260944-72f233eae2e0?auto=format&fit=crop&w=900&q=80",
    mapsQuery:"Saly quad dunes",
    phone:"",
    waText:"Bonjour DIGIY, je veux r√©server une sortie Quad (DIGIY EXPLORE)."
  },
  {
    id:"ngor-sunset",
    name:"Spot Sunset Ngor",
    type:"plage",
    zone:"dakar",
    city:"Ngor / Almadies",
    lat:14.7468, lng:-17.5242,
    badge:"Sunset",
    desc:"Simple, efficace : coucher de soleil, ambiance bord de mer.",
    photo:"https://images.unsplash.com/photo-1518837695005-2083093ee35b?auto=format&fit=crop&w=900&q=80",
    mapsQuery:"Ngor Senegal",
    phone:"",
    waText:"Bonjour DIGIY, je cherche un spot sunset √† Ngor (DIGIY EXPLORE)."
  },
  {
    id:"chez-baptiste",
    name:"Chez Baptiste ‚Äî R√©sidence",
    type:"hebergement",
    zone:"saly",
    city:"Saly",
    lat:14.4382, lng:-17.0104,
    badge:"DIGIY LOC",
    desc:"Appartement √©quip√©, r√©sidence + piscine, proche plage. Gestion DIGIY LOC.",
    photo:"https://images.unsplash.com/photo-1505691938895-1758d7feb511?auto=format&fit=crop&w=900&q=80",
    mapsQuery:"Saly residence piscine",
    phone:"",
    link:"https://beauville.github.io/chez-baptiste-digiy-loc/",
    waText:"Bonjour DIGIY, je veux infos sur Chez Baptiste (DIGIY LOC) √† Saly."
  }
];

/* ============================
   Helpers
   ============================ */
const $ = (s)=>document.querySelector(s);
const $$ = (s)=>Array.from(document.querySelectorAll(s));

function esc(s){
  return String(s||"").replace(/[&<>"']/g, m => ({
    "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
  }[m]));
}
function typeLabel(t){
  const map = {
    resto:"üç≤ Resto",
    plage:"üèñ Plage",
    culture:"üé≠ Culture",
    nature:"üåø Nature",
    hebergement:"üè† H√©bergement",
    activite:"üèÅ Activit√©"
  };
  return map[t] || t;
}
function zoneLabel(z){
  const map = {dakar:"Dakar", saly:"Saly", "petite-cote":"Petite C√¥te"};
  return map[z] || z;
}
function waLink(text){
  return `https://wa.me/${DIGIY_WA}?text=${encodeURIComponent(text||"Bonjour DIGIY EXPLORE üëã")}`;
}
function mapsLink(query, lat, lng){
  // Si coords dispo => direct; sinon query
  if(typeof lat==="number" && typeof lng==="number"){
    return `https://www.google.com/maps/search/?api=1&query=${lat},${lng}`;
  }
  return `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(query||"Senegal")}`;
}
function telLink(phone){
  const p = String(phone||"").trim();
  if(!p) return "";
  return `tel:${p.replace(/\s+/g,"")}`;
}

/* ============================
   Filters state
   ============================ */
let filterType = "all";
let filterZone = "all";
let q = "";

/* ============================
   MAP init
   ============================ */
const map = L.map("map", { zoomControl:true }).setView([14.68,-17.45], 7);

L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{
  attribution:"¬© OpenStreetMap"
}).addTo(map);

const markersById = new Map();
let markerLayer = L.layerGroup().addTo(map);

/* ============================
   Render cards + map markers
   ============================ */
function getFiltered(){
  const qq = q.trim().toLowerCase();
  return SPOTS.filter(s=>{
    const okType = (filterType==="all") ? true : s.type===filterType;
    const okZone = (filterZone==="all") ? true : s.zone===filterZone;
    const hay = `${s.name} ${s.city} ${s.desc} ${s.type} ${s.zone}`.toLowerCase();
    const okQ = qq ? hay.includes(qq) : true;
    return okType && okZone && okQ;
  });
}

function popupHtml(s){
  const title = esc(s.name);
  const sub = `${typeLabel(s.type)} ‚Ä¢ ${esc(s.city || zoneLabel(s.zone))}`;
  const links = [];

  links.push(`<a target="_blank" rel="noopener" href="${waLink(s.waText || ("Bonjour DIGIY, infos pour "+s.name+" (DIGIY EXPLORE)."))}">üí¨ WhatsApp</a>`);
  links.push(`<a target="_blank" rel="noopener" href="${mapsLink(s.mapsQuery, s.lat, s.lng)}">üìç Maps</a>`);

  if(s.phone && telLink(s.phone)){
    links.push(`<a href="${telLink(s.phone)}">üìû Appeler</a>`);
  }
  if(s.link){
    links.push(`<a target="_blank" rel="noopener" href="${s.link}">üîó Fiche</a>`);
  }

  return `
    <div class="popup-title">${title}</div>
    <div class="popup-sub">${esc(sub)}</div>
    <div style="font-size:12px;line-height:1.45;color:#e5e7eb;margin-bottom:8px">
      ${esc(s.desc || "")}
    </div>
    <div class="popup-links">${links.join("")}</div>
  `;
}

function renderMarkers(list){
  markerLayer.clearLayers();
  markersById.clear();

  list.forEach(s=>{
    if(typeof s.lat!=="number" || typeof s.lng!=="number") return;

    const m = L.marker([s.lat, s.lng]).bindPopup(popupHtml(s), { maxWidth: 260 });
    m.on("click", ()=>{ /* keep */ });
    m.addTo(markerLayer);
    markersById.set(s.id, m);
  });
}

function focusSpot(s){
  if(typeof s.lat==="number" && typeof s.lng==="number"){
    map.setView([s.lat, s.lng], 13, { animate:true });
    const m = markersById.get(s.id);
    if(m){
      m.openPopup();
    }else{
      // fallback: rebuild markers then open
      renderMarkers(getFiltered());
      const m2 = markersById.get(s.id);
      if(m2) m2.openPopup();
    }
  }
}

function renderCards(list){
  const grid = $("#spotsGrid");
  const empty = $("#emptyState");

  grid.innerHTML = "";
  empty.style.display = list.length ? "none" : "block";

  list.forEach(s=>{
    const badge = esc(s.badge || zoneLabel(s.zone));
    const title = esc(s.name);
    const sub = esc(`${typeLabel(s.type)} ‚Ä¢ ${s.city || zoneLabel(s.zone)}`);
    const desc = esc(s.desc || "");
    const photo = s.photo ? `<div class="card-photo"><img src="${esc(s.photo)}" alt="${title}"></div>` : "";

    const btnWA = waLink(s.waText || ("Bonjour DIGIY, infos pour "+s.name+" (DIGIY EXPLORE)."));
    const btnMaps = mapsLink(s.mapsQuery, s.lat, s.lng);
    const btnTel = s.phone ? telLink(s.phone) : "";
    const btnLink = s.link || "";

    const actions = `
      <div class="card-actions">
        <a class="btn btn-main" href="${btnWA}" target="_blank" rel="noopener">üí¨ WhatsApp</a>
        <a class="btn btn-outline" href="${btnMaps}" target="_blank" rel="noopener">üìç Maps</a>
        ${btnTel ? `<a class="btn btn-outline" href="${btnTel}">üìû Appel</a>` : ""}
        ${btnLink ? `<a class="btn btn-outline" href="${esc(btnLink)}" target="_blank" rel="noopener">üîó Fiche</a>` : ""}
      </div>
    `;

    const card = document.createElement("article");
    card.className = "card";
    card.innerHTML = `
      <div class="card-top">
        <div>
          <div class="card-title">${title}</div>
          <div class="card-sub">${sub}</div>
        </div>
        <div class="card-badge">${badge}</div>
      </div>
      <div class="card-body">${desc}</div>
      ${photo}
      <div class="card-meta">
        <span>üìç ${esc(s.city || zoneLabel(s.zone))}</span>
        <span>üè∑ ${esc(typeLabel(s.type))}</span>
      </div>
      ${actions}
    `;

    // click card => focus on map
    card.style.cursor = "pointer";
    card.addEventListener("click", (e)=>{
      // Si clique sur un bouton/lien => laisse
      const a = e.target.closest("a");
      if(a) return;
      focusSpot(s);
    });

    grid.appendChild(card);
  });
}

function renderAll(){
  const list = getFiltered();
  renderCards(list);
  renderMarkers(list);

  // Ajuster vue si filtre tr√®s restrictif
  if(list.length === 1){
    focusSpot(list[0]);
  }
}

/* ============================
   Chip handlers
   ============================ */
function setupChips(containerId, key){
  const wrap = document.getElementById(containerId);
  if(!wrap) return;
  wrap.querySelectorAll(".chip").forEach(chip=>{
    chip.addEventListener("click", ()=>{
      wrap.querySelectorAll(".chip").forEach(c=>c.classList.remove("active"));
      chip.classList.add("active");
      const v = chip.dataset[key];
      if(key === "type") filterType = v || "all";
      if(key === "zone") filterZone = v || "all";
      renderAll();
    });
  });
}

setupChips("chipsType", "type");
setupChips("chipsZone", "zone");

/* Search */
const qInput = document.getElementById("q");
qInput.addEventListener("input", ()=>{
  q = qInput.value || "";
  renderAll();
});

/* Initial render */
renderAll();
</script>
</body>
</html>
